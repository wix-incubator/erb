# wix-express-monitor

A middleware module that enriches express by adding a monitoring callback for each request which include information
 about the request -

* startTime
* route
* time to first byte
* time to finish
* was there a timeout?
* any errors

The module relies on other modules to enrich express with additional request lifecycle events - namely the ```x-timeout```, ```x-error``` and ```x-before-flushing-headers```
events generated by the ```patch-server-response```, ```wix-express-timeout``` and ```wix-express-error-capture``` modules.

## install
```javascript
    npm install wix-express-monitor --save
```

## usage
```javascript

// setup the dependent modules
var serverResponsePatch = require('patch-server-response');
var wixDomain = require('wix-express-domain');
var wixExpressErrorCapture = require('wix-express-error-capture');
var wixExpressTimeout = require('wix-express-timeout');

serverResponsePatch.patch();
testApp.use(wixDomain.wixDomainMiddleware());
testApp.use(wixExpressErrorCapture.asyncErrorMiddleware);
testApp.use(wixExpressTimeout.middleware(10));

// setup the monitor
testApp.use(expressMonitor(function(metric) {
  // do something with the request metric
}));

// register the rest of the application
...

// complete setting up the error capture
testApp.use(wixExpressErrorCapture.syncErrorMiddleware);
```
